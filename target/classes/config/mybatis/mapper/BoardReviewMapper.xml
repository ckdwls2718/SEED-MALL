<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.board.mapper.BoardReviewMapper">
<insert id="insertReview" parameterType="Review">
	<selectKey keyProperty="ridx" order="BEFORE" resultType="int">
		select board_review_seq.nextval from dual
	</selectKey>
	insert into board_review(ridx,midx,oidx,rtitle,rcontent,rname,rreadnum,rlikenum,score,rdate) 
	values(#{ridx},#{midx},#{oidx},#{rtitle},#{rcontent:VARCHAR},#{rname:VARCHAR},#{rreadnum},#{rlikenum},#{score},sysdate)	
</insert>

	<select id="getReview" resultType="Review" parameterType="_int">
       select b.*,(select email from member where midx=b.midx ) email from board_review b join orders o on b.oidx=o.oidx where pidx=#{value}
    </select>
    
    <select id="getReviewVO" parameterType="Review" resultType="Review">
		select board_review.*,(select email from member where midx=board_review.midx ) email from  board_review where ridx=#{ridx}
	</select>
    
	<update id="updateReadnum" parameterType="int">
		update board_review set rreadnum=rreadnum+1 where ridx=#{value}
	</update>
	
	<select id="selectBoardByIdx" resultType="Review" parameterType="int">
		select board_review.*,(select email from member where midx=board_review.midx ) email from  board_review where ridx=#{value}
	</select>
	
	<update id="updateReview" parameterType="Review">
		update board_review set rcontent=#{rcontent},rtitle=#{rtitle} where ridx=#{ridx}
	</update>
	
	<delete id="deleteReview" parameterType="int">
		delete from board_review where ridx=#{value}
	</delete>
</mapper>